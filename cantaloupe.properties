# Cantaloupe IIIF Image Server Configuration
# Cantaloupe IIIF 图像服务器配置

# URL encoding settings
# Ensure incoming URLs are decoded correctly. UTF-8 is standard for IIIF.
http.url_encoding = UTF-8

# Base URI for the IIIF API
# 用于 IIIF API 的基本 URI，这对反向代理至关重要
base_uri = http://192.168.5.13:3000

# Enable the FilesystemSource to read images from a local folder
# 启用 FilesystemSource 以从本地文件夹读取图像
source.static = FilesystemSource

# Path to the image directory (mapped via Docker volume)
# 图像目录路径（通过 Docker 卷映射）
# Note: In production this is mapped to NAS path
# 注意：在生产环境中，这映射到 NAS 路径
# FilesystemSource.BasicLookupStrategy.path_prefix = /var/lib/cantaloupe/images/
# Ensure trailing slash is handled correctly. If the prefix ends with slash, it might be double-slashed with filename
# 确保正确处理结尾斜杠。如果前缀以斜杠结尾，可能会与文件名产生双斜杠。
# Cantaloupe usually handles this, but let's be explicit.
FilesystemSource.BasicLookupStrategy.path_prefix = /var/lib/cantaloupe/images/

# FilesystemSource.BasicLookupStrategy.path_prefix = /opt/cantaloupe/
# FilesystemSource.BasicLookupStrategy.extension = 
# IMPORTANT: When extension is empty, Cantaloupe looks for exact filename match
# 重要：当后缀为空时，Cantaloupe 会查找精确的文件名匹配
# FilesystemSource.BasicLookupStrategy.extension = 

# Enable lookup strategy that doesn't rely on extension
# 启用不依赖后缀的查找策略
# FilesystemSource.lookup_strategy = BasicLookupStrategy
# FilesystemSource.lookup_strategy = ScriptLookupStrategy
# FilesystemSource.ScriptLookupStrategy.delegate_script_pathname = delegates.rb 
# Revert to default BasicLookupStrategy but ensure extension is ignored if needed
# Use empty string to disable extension-based lookup, relying on exact filename match
FilesystemSource.lookup_strategy = BasicLookupStrategy
FilesystemSource.BasicLookupStrategy.extension = 

# Enable processors for different formats
# 启用不同格式的处理器
# Use GraphicsMagick for JPEGs to handle complex ICC profiles and 16-bit depth (Hasselblad)
# 对于 JPEG 使用 GraphicsMagick 以处理复杂的 ICC 配置文件和 16 位色深（哈苏相机）
processor.fallback = Java2dProcessor
processor.tif = Java2dProcessor

# Use GraphicsMagick for all JPEG variants to avoid Java2D "format disagreement" and 16-bit issues
# 使用 GraphicsMagick 处理所有 JPEG 变体，以避免 Java2D "格式不一致" 和 16 位问题
processor.jpg = GraphicsMagickProcessor
processor.JPG = GraphicsMagickProcessor
processor.jpeg = GraphicsMagickProcessor
processor.JPEG = GraphicsMagickProcessor
# processor.jpg = Java2dProcessor
# processor.JPG = Java2dProcessor
# processor.jpeg = Java2dProcessor
# processor.JPEG = Java2dProcessor

# processor.png = Java2dProcessor

# Let Cantaloupe auto-detect format based on content, not extension
# 让 Cantaloupe 根据内容自动检测格式，而不是后缀
processor.image/jpeg = GraphicsMagickProcessor
# processor.image/jpeg = Java2dProcessor
# Try TurboJpegProcessor if available, it's faster and often more robust for standard JPEGs
# processor.image/jpeg = TurboJpegProcessor
# processor.image/jpeg = Java2dProcessor
processor.image/tiff = Java2dProcessor
processor.image/png = Java2dProcessor
processor.image/bmp = Java2dProcessor

# Explicitly map common extensions to Java2dProcessor to override any inference
# processor.jpg = Java2dProcessor
# processor.jpeg = Java2dProcessor
# processor.JPG = Java2dProcessor
# processor.JPEG = Java2dProcessor

# Explicitly map common extensions to Java2dProcessor to override any inference
# processor.jpg = Java2dProcessor
# processor.jpeg = Java2dProcessor
# processor.JPG = Java2dProcessor
# processor.JPEG = Java2dProcessor

# Memory Cache settings for low RAM environment
# 低内存环境的内存缓存设置
# cache.server.source = FilesystemCache
# cache.server.source.filesystem.pathname = /var/lib/cantaloupe/cache
# cache.server.derivative = FilesystemCache
# cache.server.derivative.filesystem.pathname = /var/lib/cantaloupe/cache
# Disable cache entirely to rule out permission issues during debug
# 在调试期间完全禁用缓存，以排除权限问题
cache.server.source = 
cache.server.derivative = 

# Disable memory cache to save RAM for processing
# 禁用内存缓存以节省 RAM 用于处理
cache.server.memory.enabled = false

# Stream optimization
# 流式优化
# Ensure we don't load full images into heap
# 确保不将完整图像加载到堆中
processor.stream_retrieval_strategy = STREAM

# Enable IIIF API
# 启用 IIIF API
endpoint.iiif.2.enabled = true
endpoint.iiif.2.min_size = 64

# CORS (Cross-Origin Resource Sharing)
# 允许跨域请求，这对于 Mirador 等前端查看器是必需的
endpoint.public.auth.basic.enabled = false
endpoint.public.auth.secret = mySuperSecretPassword
endpoint.public.cors.enabled = true
endpoint.public.cors.allow_origin = *
endpoint.public.cors.allow_methods = GET, POST, OPTIONS, PUT, DELETE
endpoint.public.cors.allow_headers = Authorization, Content-Type, X-Requested-With, Accept, Origin, User-Agent, DNT, Cache-Control, X-Mx-ReqToken, Keep-Alive, X-Requested-With, If-Modified-Since
endpoint.public.cors.allow_credentials = true
endpoint.public.cors.max_age = 1800

# Logging
# 日志记录
http.enabled = true
http.host = 0.0.0.0
http.port = 8182
log.application.level = DEBUG
log.application.ConsoleAppender.enabled = true
log.application.FileAppender.enabled = false
log.application.RollingFileAppender.enabled = false
log.error.level = WARN
log.error.ConsoleAppender.enabled = true
log.error.FileAppender.enabled = false
log.error.RollingFileAppender.enabled = false
